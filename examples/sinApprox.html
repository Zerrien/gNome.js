<html>
	<head>
		<script src="../gNome.js" type="text/javascript"></script>
		<script type="text/javascript">
			var g;
			function init() {
				g = gNome.makeGenome({
					"traits":{
						"position":{
							"wildcard":function() {
								return -5 + (10+5) * Math.random();
							},
							"fitness":function(_trait) {
								return blackBox(_trait);
							},
							"crossover":function(_a, _b) {
								_t = this.wildcard();
								if(Math.random() < 0.5) {
									if(Math.random() < 0.5) {
										return _a;
									} else {
										return _b;
									}
								} else {
									_t = (_a + _b) / 2;
								}
								return _t;
							},
							"mutate":function(_trait) {
								if(Math.random() < 0.01) {
									if(Math.random() < 0.5) {
										_trait += Math.random() * 0.5;
									} else {
										_trait -= Math.random() * 0.5;
									}
								}
								return _trait;
							}
						}
					},
					"selection":function(_pop) {
						var n = 10;
						var tournamentSelect = new gNome.Population(_pop.genome);
						for(var i = 0; i < n; i++) {
							var tIndv = _pop.getRandomIndv();
							while(tournamentSelect.findIndv(tIndv) != -1) {
								tIndv = _pop.getRandomIndv();
							}
							tournamentSelect.addIndividual(tIndv);
						}
						return tournamentSelect.getFittest();
					}
				});
				var pop = gNome.makePopulation(g,{
					"count":1000
				});
				console.log(pop.getFittest().getFitness());
				
				setInterval(function() {
					pop.incrementGeneration();
					console.log((1.8109142345802 - pop.getFittest().traits.position).toFixed(16), pop.getFittest().traits.position, pop.getFittest().getFitness());
				}, 100)
			}
			function blackBox(_x) {
				//_x to max(f(x)) ~= 1.8109142345802
 				return (-1 * Math.pow(_x - 3, 2) / 10) + Math.sin(_x) + 3;
			}
		</script>
	</head>
	<body onload="init()">
	</body>
</html>