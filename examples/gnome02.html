<html>
	<head>
		<script src="../gNome.js" type="text/javascript"></script>
		<script type="text/javascript">
			function init() {
				var g = gNome.makeGenome({
					"traits":{
						"eff":{
							"wildcard":function() {
								return Math.random();
							},
							"fitness":function(_trait) {
								return _trait;
							},
							"crossover":function(_a, _b) {
								return _a;
							},
							"mutate":function(_traitValue) {
								return _traitValue;
							}
						}
					},
					"selection":function(_pop) {
						return _pop.getRandomIndv();
					}
				});
				var pop = g.makePopulation(1000);
				var p1 = new Promise(function(_resolve, _reject) {
					var returns = 0;
					var actuals = 0;
					var resolveFunc = function() {
						return {"returns":returns, "actuals":actuals};
					}

					for(var i = 0; i < pop.individuals.length; i++) {
						var iv = pop.individuals[i];
						iv.getFitness().then(function(_value) {
							returns += 1;
							actuals += 1;
							if(returns == 1000) {
								_resolve(resolveFunc());
							}
						}).catch(function(_reason) {
							returns += 1;
							if(returns == 1000) {
								_resolve(resolveFunc());
							}
						})
					}

					setTimeout(function() {
						console.log("?????");
						_reject("5 second timeout!");
					}, 5000);
				}).then(function(_value) {
					console.log(_value);
				}).catch(function(_reason) {
					console.log(_reason);
				});
				
				//console.log(pop.getFittest().getFitness());
				//pop.incrementGeneration();
			}

			/*
			var p1 = new Promise(function(_resolve, _reject) {
				if(Math.random() < 0.5) {
					_resolve("???");
				} else {
					_reject("WRONG!");
				}
			}).then(function(_val) {
				console.log(_val + "!!!");
			}).catch(function(_reason) {
				console.log(_reason + "###");
			});
			*/
		</script>
	</head>
	<body onload="init()">
	</body>
</html>